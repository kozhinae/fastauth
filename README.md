Схема управления доступом (ACL)

В проекте реализована собственная система разграничения доступа. Она построена на ролевой модели с поддержкой разрешений на уровне ресурсов.

1. Основные сущности в БД

users – таблица пользователей

id – уникальный идентификатор

email, hashed_password – данные для аутентификации

full_name – имя пользователя

is_active – активен ли аккаунт (для мягкого удаления)

roles – таблица ролей

id – уникальный идентификатор роли

name – название роли (например, admin, editor, viewer)

permissions – таблица разрешений

id – уникальный идентификатор

resource – название ресурса (например, "article", "profile")

action – действие (например, "read", "update", "delete")

user_roles – связь пользователей с ролями (многие-ко-многим)

user_id → users.id

role_id → roles.id

role_permissions – связь ролей с разрешениями (многие-ко-многим)

role_id → roles.id

permission_id → permissions.id

2. Логика доступа

Пользователь может иметь одну или несколько ролей.

Роль содержит набор разрешений.

Разрешение определяет, к какому ресурсу и какое действие можно совершать.

Пример:

Роль admin → имеет право article:read, article:update, user:update, user:delete.

Роль editor → имеет право article:read, article:update.

Роль viewer → имеет право только article:read.

3. Проверка прав в API

При входе в систему пользователю выдаётся JWT-токен.

В каждом запросе токен проверяется → определяется текущий пользователь.

Через зависимости FastAPI выполняется:

Проверка, авторизован ли пользователь (401 Unauthorized, если нет).

Проверка, есть ли у него требуемое разрешение (403 Forbidden, если доступ запрещён).

4. Пример работы ACL

Запрос GET /articles/ требует права article:read.

Пользователь с ролью viewer или editor или admin получит список статей.

Пользователь без этого права получит 403 Forbidden.

Запрос POST /articles/1/update требует права article:update.

admin и editor смогут выполнить запрос.

viewer получит 403 Forbidden.

5. API для администратора

GET /admin/roles/ – получить список ролей и их прав

POST /admin/roles/{role_id}/permissions/ – назначить разрешение роли

POST /admin/users/{user_id}/roles/ – назначить пользователю роль

Таким образом, администратор может на лету управлять доступом.
